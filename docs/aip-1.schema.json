{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://brood.sh/spec/aip-1.schema.json",
  "title": "Agent Intake Protocol (AIP) v1",
  "description": "A minimal request/response contract for an optional intake endpoint that returns curated repo entrypoints and optional context pack URLs.",
  "type": "object",
  "$defs": {
    "IntakeRequest": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "schema_version",
        "agent",
        "task"
      ],
      "properties": {
        "schema_version": {
          "const": "aip-1"
        },
        "agent": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "tool"
          ],
          "properties": {
            "tool": {
              "type": "string",
              "minLength": 1,
              "description": "Agent host/tool identifier, e.g. 'codex', 'cursor', 'claude-code', 'chatgpt'."
            },
            "tool_version": {
              "type": "string",
              "minLength": 1
            },
            "git_user_agent": {
              "type": "string",
              "minLength": 1,
              "description": "Optional git transport UA if available (informational only)."
            }
          }
        },
        "repo": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "url": {
              "type": "string",
              "minLength": 1,
              "description": "Repo URL (optional)."
            },
            "ref": {
              "type": "string",
              "minLength": 1,
              "description": "Branch/tag/SHA (optional)."
            }
          }
        },
        "task": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "tags"
          ],
          "properties": {
            "tags": {
              "type": "array",
              "minItems": 1,
              "maxItems": 16,
              "uniqueItems": true,
              "items": {
                "type": "string",
                "minLength": 1
              },
              "description": "Coarse, privacy-preserving task tags (no raw prompts)."
            },
            "notes": {
              "type": "string",
              "maxLength": 2000,
              "description": "Optional high-level notes; should be non-sensitive and non-identifying."
            }
          }
        },
        "telemetry": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "opt_out": {
              "type": "boolean",
              "default": false,
              "description": "If true, the server should minimize/skip logging."
            }
          }
        }
      },
      "examples": [
        {
          "schema_version": "aip-1",
          "agent": {
            "tool": "codex",
            "tool_version": "0.0"
          },
          "repo": {
            "url": "https://github.com/<org-or-user>/brood",
            "ref": "main"
          },
          "task": {
            "tags": [
              "desktop-quick-actions",
              "engine-events"
            ],
            "notes": "Add a new Ability; keep events.jsonl stable."
          }
        }
      ]
    },
    "IntakeResponse": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "schema_version",
        "entrypoints"
      ],
      "properties": {
        "schema_version": {
          "const": "aip-1"
        },
        "session": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "id"
          ],
          "properties": {
            "id": {
              "type": "string",
              "minLength": 8,
              "description": "Opaque session id for correlating optional pack downloads/referrals."
            },
            "expires_at": {
              "type": "string",
              "format": "date-time"
            }
          }
        },
        "entrypoints": {
          "type": "array",
          "minItems": 1,
          "maxItems": 64,
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "path",
              "why"
            ],
            "properties": {
              "path": {
                "type": "string",
                "minLength": 1,
                "description": "Workspace-relative path (or a directory path ending in '/')."
              },
              "why": {
                "type": "string",
                "minLength": 1,
                "maxLength": 300
              },
              "kind": {
                "type": "string",
                "enum": [
                  "doc",
                  "source",
                  "script",
                  "config",
                  "test",
                  "asset"
                ]
              },
              "priority": {
                "type": "integer",
                "minimum": 1,
                "maximum": 10
              }
            }
          }
        },
        "commands": {
          "type": "array",
          "maxItems": 32,
          "items": {
            "type": "string",
            "minLength": 1
          },
          "description": "Optional commands for running/tests; should be safe and deterministic."
        },
        "packs": {
          "type": "array",
          "maxItems": 16,
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "id",
              "url",
              "purpose"
            ],
            "properties": {
              "id": {
                "type": "string",
                "minLength": 1
              },
              "url": {
                "type": "string",
                "minLength": 1,
                "description": "Optional context pack URL (can be public or short-lived signed URL)."
              },
              "sha256": {
                "type": "string",
                "pattern": "^[A-Fa-f0-9]{64}$"
              },
              "bytes": {
                "type": "integer",
                "minimum": 1
              },
              "purpose": {
                "type": "string",
                "minLength": 1,
                "maxLength": 300
              }
            }
          }
        },
        "notes": {
          "type": "array",
          "maxItems": 32,
          "items": {
            "type": "string",
            "minLength": 1,
            "maxLength": 400
          }
        },
        "attribution": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "text": {
              "type": "string",
              "minLength": 1,
              "maxLength": 300,
              "description": "Optional short attribution snippet."
            },
            "referral_url": {
              "type": "string",
              "minLength": 1
            }
          }
        }
      },
      "examples": [
        {
          "schema_version": "aip-1",
          "session": {
            "id": "sess_01HRZ6V9Y2P2Q9Q7"
          },
          "entrypoints": [
            {
              "path": "docs/desktop.md",
              "kind": "doc",
              "why": "Abilities mental model and HUD output semantics.",
              "priority": 1
            },
            {
              "path": "desktop/src/canvas_app.js",
              "kind": "source",
              "why": "Abilities rendering and action dispatch.",
              "priority": 1
            },
            {
              "path": "brood_engine/cli.py",
              "kind": "source",
              "why": "Engine command wiring used by Abilities.",
              "priority": 2
            }
          ],
          "commands": [
            "./scripts/dev_desktop.sh",
            "python -m pytest"
          ],
          "packs": [
            {
              "id": "desktop-quick-actions",
              "url": "https://brood.sh/aip/packs/desktop-quick-actions@<ref>.json",
              "sha256": "0000000000000000000000000000000000000000000000000000000000000000",
              "purpose": "Curated excerpts for Abilities + event stream expectations."
            }
          ],
          "notes": [
            "Desktop expects Tauri v1 APIs (@tauri-apps/api v1).",
            "Do not store prompts/secrets in the repo; use .env (gitignored) based on .env.example."
          ]
        }
      ]
    }
  }
}
